#!/bin/bash

set -e

echo 'Make a sandwich, this may take a few'

pre_install () {
  wget "$1" -O "$HOME/$2"
  tar zxvf "$HOME/$2" -C $HOME/
}

command_exists () {
  type "$1" &> /dev/null ;
}

if ! command_exists docker; then 
  echo 'installing docker...'
  brew install docker
  brew install docker machine
fi

if ! command_exists kubectl; then
  echo 'installing kubectl...'
  pre_install https://github.com/kubernetes/kubernetes/releases/download/v1.4.4/kubernetes.tar.gz kubernetes.tar.gz 
  cp $HOME/kubernetes/platforms/darwin/amd64/kubectl /usr/local/bin/kubectl
fi

if ! command_exists helm; then
  echo 'installing helm...'
  pre_install http://storage.googleapis.com/kubernetes-helm/helm-v2.0.0-beta.2-darwin-amd64.tar.gz helm-v2.0.0-beta.2-darwin-amd64.tar.gz
  cp $HOME/darwin-amd64/helm /usr/local/bin/helm
fi

if ! command_exists minikube; then
  echo 'installing minikube...'
  wget https://storage.googleapis.com/minikube/releases/v0.12.0/minikube-darwin-amd64 -O minikube
  chmod +x minikube
  mv minikube /usr/local/bin/minikube
fi